gradle.taskGraph.afterTask { Task task, TaskState state ->
    if (state.failure ) {
        def reasonFile = new File("failureReasonFile");
        def rootException = state.failure;
        while (rootException.cause != null)
            rootException = rootException.cause;

        def reason = "Message: ${rootException.message} Exception: ${rootException.class}"
        reasonFile.append(System.getProperty("line.separator")+"Task: ${task.name} Reason: ${reason}");
    }
}
